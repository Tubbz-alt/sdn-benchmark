<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>SEFloodlight Auditing</title>
  </head>
  <body>

  <h2>Configuration File</h2>
    Auditing configuration is encapsulated by the file, <code>runtime/config/auditCtl.json</code>.
    (Note:
    this path is specified in <code>runtime/config/floodlight.properties</code>
    as the property
    <code>net.floodlightcontroller.audit.AuditDaemon.configuration</code>.)<br>
    <br>
    This file has four primary keys:
    <ul>
      <li><code>"enabled"</code>, a <code>boolean</code> indicating
        whether auditing is enabled;</li>
      <li><code>"outputFile"</code>, where <code>varint</code>-delimited
        binary Google Protocol Buffer audit records are written;</li>
      <li><code>"log"</code>, which audit records are written; and</li>
      <li><code>"queueConfig"</code>, how to throttle/filter audit
        records when record congestion occurs.</li>
    </ul>
    For a complete description of these entries, see <a href="Audit_control.html">here</a>;
    an annotated exemplar audit configuration file is <a href="auditCtlJson.html">here</a>.<br>

    <h2>REST API</h2>
    The audit daemon also supports the following REST JSON API:<br>
    <br>
    <table border="1" cellpadding="4" cellspacing="2" style="margin-left: 40px;">
      <tbody>
        <tr>
          <td align="center"><b>URI</b></td>
          <td align="center"><b>Method</b></td>
          <td align="center"><b>Description</b></td>
          <td align="center"><b>Arguments</b></td>
        </tr>
        <tr>
          <td><code>/wm/auditdaemon/module/</code><i>&lt;op&gt;</i><code>/json</code></td>
          <td align="center"><code>GET</code></td>
          <td>Configure or control audit daemon</td>
          <td>where <i>&lt;op&gt;</i> may be
          	<ul>
          	<li><code>status</code>, to obtain audit status</li>
          	<li><code>enable</code>, to enable auditing</li>
          	<li><code>disable</code>, to disable auditing</li>
          	<li><code>refresh</code>, to refresh auditing configuration from file</li>
          	</ul>
          </td>
        </tr>
        <tr>
          <td><code>/wm/auditdaemon/rules/json</code></td>
          <td align="center"><code>GET</code>/<code>POST</code></td>
          <td>Gets or sets audit configuration
          </td>
          <td>
          	<code>GET</code>: <i>none</i><br>
			<code>POST</code>: <code>{"</code><i>&lt;field<sub>1</sub>&gt;</i><code>":"</code><i>&lt;value<sub>1</sub>&gt;</i><code>", "</code><i>&lt;field<sub>2</sub>&gt;</i><code>":"</code><i>&lt;value<sub>2</sub>&gt;</i><code>",</code> ...<code>}</code><br>
			where <i>&lt;field<sub>i</sub>&gt;</i> may be <code>enabled</code>, <code>outputFile</code>, <code>log</code>, or <code>queueConfig</code>.<br>Again, see <a href="Audit_control.html">here</a> for further information.
          </td>
        </tr>
      </tbody>
    </table>
    <br>
    Thus, given that
    <code>net.floodlightcontroller.restserver.RestApiServer.</code>{<code>host</code>,<code>port</code>}
    are set to {<code>127.0.0.1</code>,<code>8080</code>},
    here are example REST API queries:<br>
    <br>
    <div style="margin-left: 20px;"><code>
    curl http://localhost:8080/wm/auditdaemon/module/status/json<br>
	curl http://localhost:8080/wm/auditdaemon/module/enable/json<br>
	curl http://localhost:8080/wm/auditdaemon/module/disable/json<br>
	curl http://localhost:8080/wm/auditdaemon/module/refresh/json<br>
	<br>
	curl -X GET -H "Content-Type: application/json" http://localhost:8080/wm/auditdaemon/rules/json
    </code></div>

    <h2>Print Utility</h2>
    <div style="margin-left: 20px;">
     <code>java -jar util/auditprint.jar </code><i>&lt;audit record file&gt;</i><br>
    <br>
    or<br>
    <br>
    <code>java -cp runtime/SEFloodlight.jar AuditPrint </code><i>&lt;audit record file&gt;</i><br>
    </div><br>
    write a text representation of audit records to <code>stdout</code>.

    <h2>Developing An Audit Log Processing Application</h2>
    Audit records are <code>varint</code>-prefixed binary Google Protocol Buffer records, as defined in
    <code>dev/proto/</code>, where <code>OFAuditPB.proto</code> is the root container.  (An example
    binary audit record file is <code>util/example/example_auditRecords.gpb</code>.)  The <code>.proto</code>
    file specifications are protobuf-2.5.0 compatible (see
	<a href="http://code.google.com/p/protobuf/">http://code.google.com/p/protobuf/</a> for
	further information).<br>
	<br>
	<code>dev/java/ofauditlib.jar</code> (which references classes in <code>dev/java/protobuf-java-2.5.0.jar</code>)
	is the corresponding pre-compiled Java 1.6 library,
	while <code>dev/perl/OpenFlow/NBAPI/LowLevel/PB/*.pm</code> and <code>dev/perl/OpenFlow/Audit/PB/*.pm</code>
	are the corresponding Perl protobuf implementations.

	<h3>Exemplar Java Parser</h3>
	Given that your shell's current working directory is the distribution root directory, first<br>
	<br>
    <div style="margin-left: 20px;">
     <code>cp dev/java/SimpleAuditPrint.java .</code><br>
    <br></div>

	after which <code>SimpleAuditPrint.java</code> may be compiled in one of two ways:
	<ol>
	<li><code>javac -cp runtime/SEFloodlight.jar SimpleAuditPrint.java</code> and
	</li>
	<li><code>javac -cp dev/java/ofauditlib.jar:dev/java/protobuf-java-2.5.0.jar SimpleAuditPrint.java</code>
	</li>
	</ol>

	The two associated methods of running the program with the example audit record file are
	<ol>
	<li><code>java -cp .:runtime/SEFloodlight.jar SimpleAuditPrint util/example/example_auditRecords.gpb</code> and
	</li>
	<li><code>java -cp .:dev/java/ofauditlib.jar:dev/java/protobuf-java-2.5.0.jar SimpleAuditPrint util/example/example_auditRecords.gpb</code>
	</li>
	</ol>
  </body>
</html>
